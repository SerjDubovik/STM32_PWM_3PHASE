#ifndef SRC_MODBUS
#define SRC_MODBUS

#define adrr_devise 					81 // 2				// адрес этого устройства в сети модбас
#define leth_array						100					// длинна массива для принятых/отправленых данных. служит для проверки возможности записи по адресу






	unsigned short CRC16(int *puchMsg,unsigned short usDataLen );
	extern void USART2_IRQHandler(void);
	void Modbus_slave(void);
	void init_modbus(void);
	void init_timer2(void);
	void TIM2_IRQHandler (void);


	/*
	 *  Адресное пространство и что за что отвечает:
	 *
	 *  Адрес 			Описание
	 *
	 *  0				Битовая маска состояния слейва. Мастер читает, но не пишет сюда.
	 *  1				Битовая маска для управления слейвом. Мастер пишет сюда, слейв не меняет эту переменную.
	 *  2				Слово-команда для управления слейвом. Мастер пишет, слейв читает
	 *  3				Слово-команда для передачи параметра мастеру. Мастер после прочтения переписывает переменную в ноль.
	 *
	 *  8				Счётчик, постоянно инкрементится, досчитав до края переполняется. Служит для отладки, показывает что всё ещё живенько.
	 *
	 *	9               Isens - вход с токового датчика GPIOA.0. Телеметрия, читает мастер.
	 *	10              Uzpt - вход, напряжение звена постоянного тока GPIOA.4. Телеметрия, читает мастер.
	 *	11              Un 	- выходное напряжение. обратная связь GPIOA.5. Телеметрия, читает мастер.
	 *	12              Ibreak - ток отсечки. защитная функция. GPIOA.6. Телеметрия, читает мастер.
	 *
	 *	13				Isens	значение АЦП без пересчёта
	 *	14				Uzpt	значение АЦП без пересчёта
	 *	15				Un		значение АЦП без пересчёта
	 *	16				Ibreak	значение АЦП без пересчёта
	 *
	 *	17				Коэффициент для пересчёта из АЦП в Амперы тока выхода. Телеметрия, мастер только читает.
	 *	18				Коэффициент для пересчёта из АЦП в Вольт ЗПТ. Телеметрия, мастер только читает.
	 *	19				Коэффициент для пересчёта из АЦП в Вольт выхода. Телеметрия, мастер только читает.
	 *	20				Коэффициент для пересчёта из АЦП в Амперы на ключе. Телеметрия, мастер только читает.
	 *
	 *	21				Нижнее пороговое значение напряжения ЗПТ. Порог срабатывания реле ЗПТ. Телеметрия, мастер не меняет это значение
	 *	22				Нижнее пороговое значение напряжения ЗПТ. Порог срабатывания реле ЗПТ. Задание мастером, слейв не менят это значение. Код для подтверждения (запись в адрес 2): 10
	 *
	 *	23				Текущая частота (кГц).
	 *	24				Задать частоту (кГц). Код для подтверждения (запись в адрес 2): 11
	 *
	 *	25				Текущий дедтайм (ед).
	 *	26				Задать дедтайм (ед). Код для подтверждения (запись в адрес 2): 12
	 *
	 *	27				Текуший ШИМ.
	 *	28				Едениц задания ШИМ. Код для подтверждения (запись в адрес 2): 17
	 *
	 *	29				Задать выходное напряжение (кВ). Код для подтверждения (запись в адрес 2): 13
	 *	30				Текущее токоограничение (мА).
	 *	31				Задать токоограничение (мА): Код для подтверждения (запись в адрес 2): 14
	 *
	 *	32				Температура платы управления (С).
	 *	33				Порог платы управления (С).
	 *	34				Задать порог платы (С). Код для подтверждения (запись в адрес 2): 15
	 *
	 *	35				Температура радиатора (С).
	 *	36				Порог радиатора (С).
	 *	37				Задать порог радиатора (С). Код для подтверждения (запись в адрес 2): 16
	 *
	 *	38				Коэффициент для пересчёта из АЦП в Амперы тока выхода. Мастер задаёт это значение. Код для подтверждения (запись в адрес 2):
	 *	39				Коэффициент для пересчёта из АЦП в Вольт ЗПТ. Мастер задаёт это значение. Код для подтверждения (запись в адрес 2):
	 *	40				Коэффициент для пересчёта из АЦП в Вольт выхода. Мастер задаёт это значение. Код для подтверждения (запись в адрес 2):
	 *	41				Коэффициент для пересчёта из АЦП в Амперы на ключе. Мастер задаёт это значение. Код для подтверждения (запись в адрес 2):
	 *
	 *	42				Делитель для преобразования из целого в дробное. Для тока выхода. Мастер задаёт это значение. Код для подтверждения (запись в адрес 2):
	 *	43				Делитель для преобразования из целого в дробное. Для напряжения ЗПТ. Мастер задаёт это значение. Код для подтверждения (запись в адрес 2):
	 *	44				Делитель для преобразования из целого в дробное. Для напряжения выхода. Мастер задаёт это значение. Код для подтверждения (запись в адрес 2):
	 *	45				Делитель для преобразования из целого в дробное. Для тока отсечки.  Мастер задаёт это значение. Код для подтверждения (запись в адрес 2):
	 *
	 *	46				Делитель для преобразования из целого в дробное. Для тока выхода. Мастер читпет это значение и формирует дробное число для отображения.
	 *	47				Делитель для преобразования из целого в дробное. Для напряжения ЗПТ. Мастер читпет это значение и формирует дробное число для отображения.
	 *	48				Делитель для преобразования из целого в дробное. Для напряжения выхода. Мастер читпет это значение и формирует дробное число для отображения.
	 *	49				Делитель для преобразования из целого в дробное. Для тока отсечки. Мастер читпет это значение и формирует дробное число для отображения.
	 *
	 *	50				Текущее заполнение в импульсе.
	 *	51				Едениц задания импульса. Код подтверждения (запись в адрес 2): 18
	 *
	 *	52				Текущая скважность в Buck-конверторе
	 *	53				Едениц задания скважности. Код подтверждения (запись в адрес 2): 19
	 */


	/*
	 *  Битовая маска слова состояния слейва. адрес 0
	 *
	 *  Бит				Описание
	 *
	 *  0
	 *  1
	 *  2
	 *  3
	 *
	 *  4
	 *  5
	 *  6
	 *  7
	 *
	 *  8
	 *  9
	 *  10
	 *  11
	 *
	 *  12				1 - Когда ЗПТ работает коректно, 0 - когда превышен/занижен порог напряжения.
	 *  13				1 - Когда активирована автономная работа.
	 *  14				1 - Когда реле ЗПТ замкнуто.
	 *  15				1 - Готов принимать команды пользователя. Ставится при старте контроллера после всей инициализации.
	 *
	 */

	/*
	 *  Битовая маска слова управления слейва. адрес 1
	 *
	 *  Бит				Описание
	 *
	 *  0
	 *  1
	 *  2
	 *  3
	 *
	 *  4
	 *  5
	 *  6
	 *  7
	 *
	 *  8
	 *  9
	 *  10
	 *  11
	 *
	 *  12				1 - активировать автономную работу зпт. 0 - перейти на ручное управление зпт.
	 *  13				1 - разомкнуть реле ЗПТ принудительно
	 *  14				1 - замкнуть реле ЗПТ принудительно
	 *  15				1 - замкнуть реле 2 (вентилятор). 0 - реле разомкнуто
	 */



#endif // SRC_MODBUS
