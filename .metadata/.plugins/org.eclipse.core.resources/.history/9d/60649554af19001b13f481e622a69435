#include "stm32f10x.h"
#include "modbus.h"
#include "GPIO.h"
#include "pwm.h"
#include "adc.h"



unsigned short	array_mb[100]			= {};						// массив дл€ хранени€ прин€тых/переданных слов

unsigned short	state_machine			= 0;						// переменна€ состо€ни€ системы. выбор алгоритма работмы программы
																	// 0 - ожидает выбор работы от пользовател€. работает телеметри€ по модбасу.
																	// 1 - переход к выполнению выбранного режима работы.


int main(void)
{


	init_GPIO();
    init_modbus();
    //init_pwm_3phase();
    init_pwm_PP_mode();
    init_adc();

    relay_1(off);
    relay_2(off);

    blue_led(off);
    red_led(off);



    array_mb[0] = 0x8000;											// 15 бит - 1. √отов принимать команды пользовател€

	for(;;)
	{




		switch (state_machine)
		{

			case 0:
			{

				if(array_mb[2] == 1)
				{
					array_mb[2] = 0;
				}


				if(array_mb[2] == 2)
				{
					array_mb[2] = 0;
				}


				if(array_mb[2] == 3)
				{
					array_mb[2] = 0;
				}

			}
			break;

			default:
			break;
		} // скобка свича



		array_mb[8]++;

		Modbus_slave();

	} // скобка бесконечного цикла
} // скобка мейна
