#ifndef SRC_MODBUS
#define SRC_MODBUS

#define adrr_devise 					81 // 2				// адрес этого устройства в сети модбас
#define leth_array						100					// длинна массива для принятых/отправленых данных. служит для проверки возможности записи по адресу






	unsigned short CRC16(int *puchMsg,unsigned short usDataLen );
	extern void USART2_IRQHandler(void);
	void Modbus_slave(void);
	void init_modbus(void);
	void init_timer2(void);
	void TIM2_IRQHandler (void);


	/*
	 *  Адресное пространство и что за что отвечает:
	 *
	 *  Адрес 			Описание
	 *
	 *  0				Битовая маска состояния слейва. Мастер читает, но не пишет сюда.
	 *  1				Битовая маска для управления слейвом. Мастер пишет сюда, слейв не меняет эту переменную.
	 *  2				Слово-команда для управления слейвом. Мастер пишет, слейв читает и сбрасывает в ноль.
	 *  3				Слово-команда для передачи параметра мастеру. Мастер после прочтения переписывает переменную в ноль.
	 *
	 *  8				Счётчик, постоянно инкрементится, досчитав до края переполняется. Служит для отладки, показывает что всё ещё живенько.
	 *
	 *	9               Isens - вход с токового датчика GPIOA.0. Телеметрия, читает мастер.
	 *	10              Uzpt - вход, напряжение звена постоянного тока GPIOA.4. Телеметрия, читает мастер.
	 *	11              Un 	- выходное напряжение. обратная связь GPIOA.5. Телеметрия, читает мастер.
	 *	12              Ibreak - ток отсечки. защитная функция. GPIOA.6. Телеметрия, читает мастер.
	 *
	 *	13				Isens	значение АЦП без пересчёта
	 *	14				Uzpt	значение АЦП без пересчёта
	 *	15				Un		значение АЦП без пересчёта
	 *	16				Ibreak	значение АЦП без пересчёта
	 *
	 *	17				Коэффициент для пересчёта из АЦП в Амперы тока выхода
	 *	18				Коэффициент для пересчёта из АЦП в Вольт ЗПТ
	 *	19				Коэффициент для пересчёта из АЦП в Вольт выхода
	 *	20				Коэффициент для пересчёта из АЦП в Амперы на ключе
	 *
	 *	21				Нижнее пороговое значение напряжения ЗПТ. Порог срабатывания реле ЗПТ. Телеметрия, мастер не меняет это значение
	 *	22				Нижнее пороговое значение напряжения ЗПТ. Порог срабатывания реле ЗПТ. Задание мастером, слейв не менят это значение
	 *
	 *	23				Текущая частота (кГц).
	 *	24				Задать частоту (кГц).
	 *
	 *	25				Текущий дедтайм (ед).
	 *	26				Задать дедтайм (ед).
	 *
	 *	26				Текуший ШИМ.
	 *	27				Едениц задания ШИМ.
	 *
	 *	28				Задать выходное напряжение (кВ).
	 *	29				Текущее токоограничение (мА).
	 *	30				Задать токоограничение (мА):
	 *
	 *
	 *
	 */


	/*
	 *  Битовая маска слова состояния слейва. адрес 0
	 *
	 *  Бит				Описание
	 *
	 *  0
	 *  1
	 *  2
	 *  3
	 *
	 *  4
	 *  5
	 *  6
	 *  7
	 *
	 *  8
	 *  9
	 *  10
	 *  11
	 *
	 *  12				1 - Когда ЗПТ работает коректно, 0 - когда превышен/занижен порог напряжения.
	 *  13				1 - Когда активирована автономная работа.
	 *  14				1 - Когда реле ЗПТ замкнуто.
	 *  15				1 - Готов принимать команды пользователя. Ставится при старте контроллера после всей инициализации.
	 *
	 */

	/*
	 *  Битовая маска слова управления слейва. адрес 1
	 *
	 *  Бит				Описание
	 *
	 *  0
	 *  1
	 *  2
	 *  3
	 *
	 *  4
	 *  5
	 *  6
	 *  7
	 *
	 *  8
	 *  9
	 *  10
	 *  11
	 *
	 *  12				1 - активировать автономную работу зпт. 0 - перейти на ручное управление зпт.
	 *  13				1 - разомкнуть реле ЗПТ принудительно
	 *  14				1 - замкнуть реле ЗПТ принудительно
	 *  15
	 */



#endif // SRC_MODBUS
